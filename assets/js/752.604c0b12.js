(window.webpackJsonp=window.webpackJsonp||[]).push([[752],{1205:function(s,t,a){"use strict";a.r(t);var n=a(56),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("本文通过实例来演示怎么通过Flink CDC 结合Doris的Flink Connector实现从Mysql数据库中监听数据并实时入库到Doris数仓对应的表中。")]),s._v(" "),a("h2",{attrs:{id:"_1-什么是cdc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是cdc"}},[s._v("#")]),s._v(" 1.什么是CDC")]),s._v(" "),a("p",[s._v("CDC 是变更数据捕获（Change Data Capture）技术的缩写，它可以将源数据库（Source）的增量变动记录，同步到一个或多个数据目的（Sink）。在同步过程中，还可以对数据进行一定的处理，例如分组（GROUP BY）、多表的关联（JOIN）等。")]),s._v(" "),a("p",[s._v("例如对于电商平台，用户的订单会实时写入到某个源数据库；A 部门需要将每分钟的实时数据简单聚合处理后保存到 Redis 中以供查询，B 部门需要将当天的数据暂存到 Elasticsearch 一份来做报表展示，C 部门也需要一份数据到 ClickHouse 做实时数仓。随着时间的推移，后续 D 部门、E 部门也会有数据分析的需求，这种场景下，传统的拷贝分发多个副本方法很不灵活，而 CDC 可以实现一份变动记录，实时处理并投递到多个目的地。")]),s._v(" "),a("h3",{attrs:{id:"_1-1-cdc的应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-cdc的应用场景"}},[s._v("#")]),s._v(" 1.1 CDC的应用场景")]),s._v(" "),a("ul",[a("li",[s._v("**数据同步：**用于备份，容灾；")]),s._v(" "),a("li",[s._v("**数据分发：**一个数据源分发给多个下游系统；")]),s._v(" "),a("li",[s._v("**数据采集：**面向数据仓库 / 数据湖的 ETL 数据集成，是非常重要的数据源。")])]),s._v(" "),a("p",[s._v("CDC 的技术方案非常多，目前业界主流的实现机制可以分为两种：")]),s._v(" "),a("ul",[a("li",[s._v("基于查询的 CDC：\n"),a("ul",[a("li",[s._v("离线调度查询作业，批处理。把一张表同步到其他系统，每次通过查询去获取表中最新的数据；")]),s._v(" "),a("li",[s._v("无法保障数据一致性，查的过程中有可能数据已经发生了多次变更；")]),s._v(" "),a("li",[s._v("不保障实时性，基于离线调度存在天然的延迟。")])])]),s._v(" "),a("li",[s._v("基于日志的 CDC：\n"),a("ul",[a("li",[s._v("实时消费日志，流处理，例如 MySQL 的 binlog 日志完整记录了数据库中的变更，可以把 binlog 文件当作流的数据源；")]),s._v(" "),a("li",[s._v("保障数据一致性，因为 binlog 文件包含了所有历史变更明细；")]),s._v(" "),a("li",[s._v("保障实时性，因为类似 binlog 的日志文件是可以流式消费的，提供的是实时数据。")])])])]),s._v(" "),a("h2",{attrs:{id:"_2-flink-cdc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-flink-cdc"}},[s._v("#")]),s._v(" 2.Flink CDC")]),s._v(" "),a("p",[s._v("Flink在1.11版本中新增了CDC的特性，简称 改变数据捕获。名称来看有点乱，我们先从之前的数据架构来看CDC的内容。")]),s._v(" "),a("p",[s._v("以上是之前的"),a("code",[s._v("mysq binlog")]),s._v("日志处理流程，例如 canal 监听 binlog 把日志写入到 kafka 中。而 Apache Flink 实时消费 Kakfa 的数据实现 mysql 数据的同步或其他内容等。拆分来说整体上可以分为以下几个阶段。")]),s._v(" "),a("ol",[a("li",[s._v("mysql开启binlog")]),s._v(" "),a("li",[s._v("canal同步binlog数据写入到kafka")]),s._v(" "),a("li",[s._v("flink读取kakfa中的binlog数据进行相关的业务处理。")])]),s._v(" "),a("p",[s._v("整体的处理链路较长，需要用到的组件也比较多。Apache Flink CDC可以直接从数据库获取到binlog供下游进行业务计算分析")]),s._v(" "),a("h3",{attrs:{id:"_2-1-flink-connector-mysql-cdc-2-0-特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-flink-connector-mysql-cdc-2-0-特性"}},[s._v("#")]),s._v(" 2.1 Flink Connector Mysql CDC 2.0 特性")]),s._v(" "),a("p",[s._v("提供 MySQL CDC 2.0，核心 feature 包括")]),s._v(" "),a("ul",[a("li",[s._v("并发读取，全量数据的读取性能可以水平扩展；")]),s._v(" "),a("li",[s._v("全程无锁，不对线上业务产生锁的风险；")]),s._v(" "),a("li",[s._v("断点续传，支持全量阶段的 checkpoint。")])]),s._v(" "),a("p",[s._v("网上有测试文档显示用 TPC-DS 数据集中的 customer 表进行了测试，Flink 版本是 1.13.1，customer 表的数据量是 6500 万条，Source 并发为 8，全量读取阶段:")]),s._v(" "),a("ul",[a("li",[s._v("MySQL CDC 2.0 用时 "),a("strong",[s._v("13")]),s._v(" 分钟；")]),s._v(" "),a("li",[s._v("MySQL CDC 1.4 用时 "),a("strong",[s._v("89")]),s._v(" 分钟；")]),s._v(" "),a("li",[s._v("读取性能提升 "),a("strong",[s._v("6.8")]),s._v(" 倍。")])]),s._v(" "),a("h2",{attrs:{id:"_3-什么是doris-flink-connector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-什么是doris-flink-connector"}},[s._v("#")]),s._v(" 3.什么是Doris  Flink Connector")]),s._v(" "),a("p",[s._v("Flink Doris Connector 是 doris 社区为了方便用户使用 Flink 读写Doris数据表的一个扩展，")]),s._v(" "),a("p",[s._v("目前 doris 支持 Flink 1.11.x ，1.12.x，1.13.x，Scala版本：2.12.x")]),s._v(" "),a("p",[s._v("目前Flink doris connector目前控制入库通过两个参数：")]),s._v(" "),a("ol",[a("li",[s._v("sink.batch.size\t：每多少条写入一次，默认100条")]),s._v(" "),a("li",[s._v("sink.batch.interval ：每个多少秒写入一下，默认1秒")])]),s._v(" "),a("p",[s._v("这两参数同时起作用，那个条件先到就触发写doris表操作，")]),s._v(" "),a("p",[a("strong",[s._v("注意：")])]),s._v(" "),a("p",[s._v("这里"),a("strong",[s._v("注意")]),s._v("的是要启用 http v2 版本，具体在 fe.conf 中配置 "),a("code",[s._v("enable_http_server_v2=true")]),s._v("，同时因为是通过 fe http rest api 获取 be 列表，这俩需要配置的用户有 admin 权限。")]),s._v(" "),a("h2",{attrs:{id:"_4-用法示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-用法示例"}},[s._v("#")]),s._v(" 4. 用法示例")]),s._v(" "),a("h3",{attrs:{id:"_4-1-flink-doris-connector-编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-flink-doris-connector-编译"}},[s._v("#")]),s._v(" 4.1 Flink Doris Connector 编译")]),s._v(" "),a("p",[s._v("首先我们要编译Doris的Flink connector，也可以通过下面的地址进行下载：")]),s._v(" "),a("p",[s._v("https://github.com/hf200012/hf200012.github.io/raw/main/lib/doris-flink-1.0-SNAPSHOT.jar")]),s._v(" "),a("blockquote",[a("p",[s._v("注意：")]),s._v(" "),a("p",[s._v("这里因为Doris 的Flink Connector 是基于Scala 2.12.x版本进行开发的，所有你在使用Flink 的时候请选择对应scala 2.12的版本，")]),s._v(" "),a("p",[s._v("如果你使用上面地址下载了相应的jar，请忽略下面的编译内容部分")])]),s._v(" "),a("p",[s._v("在 doris 的 docker 编译环境 "),a("code",[s._v("apache/incubator-doris:build-env-1.2")]),s._v(" 下进行编译，因为 1.3 下面的JDK 版本是 11，会存在编译问题。")]),s._v(" "),a("p",[s._v("在 extension/flink-doris-connector/ 源码目录下执行：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sh build.sh\n")])])]),a("p",[s._v("编译成功后，会在 "),a("code",[s._v("output/")]),s._v(" 目录下生成文件 "),a("code",[s._v("doris-flink-1.0.0-SNAPSHOT.jar")]),s._v("。将此文件复制到 "),a("code",[s._v("Flink")]),s._v(" 的 "),a("code",[s._v("ClassPath")]),s._v(" 中即可使用 "),a("code",[s._v("Flink-Doris-Connector")]),s._v("。例如，"),a("code",[s._v("Local")]),s._v(" 模式运行的 "),a("code",[s._v("Flink")]),s._v("，将此文件放入 "),a("code",[s._v("jars/")]),s._v(" 文件夹下。"),a("code",[s._v("Yarn")]),s._v("集群模式运行的"),a("code",[s._v("Flink")]),s._v("，则将此文件放入预部署包中。")]),s._v(" "),a("p",[a("strong",[s._v("针对Flink 1.13.x版本适配问题")])]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[s._v("   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("scala.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("2.12"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("scala.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("flink.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.11.2"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("flink.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("libthrift.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("0.9.3"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("libthrift.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("arrow.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("0.15.1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("arrow.version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("project.build.sourceEncoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("project.build.sourceEncoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("doris.home")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${basedir}/../../"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("doris.home")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("doris.thirdparty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("${basedir}/../../thirdparty"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("doris.thirdparty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),a("p",[s._v("只需要将这里的 "),a("code",[s._v("flink.version")]),s._v(" 改成和你 Flink 集群版本一致，重新编辑即可")]),s._v(" "),a("h3",{attrs:{id:"_4-2-配置flink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-配置flink"}},[s._v("#")]),s._v(" 4.2 配置Flink")]),s._v(" "),a("p",[s._v("这里我们是通过Flink Sql Client 方式来进行操作。")]),s._v(" "),a("p",[s._v("这里我们演示使用的软件版本：")]),s._v(" "),a("ol",[a("li",[s._v("Mysql 8.x")]),s._v(" "),a("li",[s._v("Apache Flink ： 1.13.3")]),s._v(" "),a("li",[s._v("Apache Doris ：0.14.13.1")])]),s._v(" "),a("h4",{attrs:{id:"_4-2-1-安装flink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-安装flink"}},[s._v("#")]),s._v(" 4.2.1 安装Flink")]),s._v(" "),a("p",[s._v("首先下载和安装 Flink ：")]),s._v(" "),a("p",[s._v("https://dlcdn.apache.org/flink/flink-1.13.3/flink-1.13.3-bin-scala_2.12.tgz")]),s._v(" "),a("p",[s._v("下载Flink CDC相关Jar包：")]),s._v(" "),a("p",[s._v("https://repo1.maven.org/maven2/com/ververica/flink-connector-mysql-cdc/2.0.2/flink-connector-mysql-cdc-2.0.2.jar")]),s._v(" "),a("p",[s._v("这里注意Flink CDC 和Flink 的版本对应关系")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211025170642628.png"),alt:""}}),s._v(" "),a("ul",[a("li",[s._v("将上面下载或者编译好的 Flink  Doris Connector jar包复制到 Flink 根目录下的lib目录下")]),s._v(" "),a("li",[s._v("Flink cdc的jar包也复制到 Flink 根目录下的lib目录下")])]),s._v(" "),a("p",[s._v("这里演示使用的是本地单机模式，")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://dlcdn.apache.org/flink/flink-1.13.3/flink-1.13.3-bin-scala_2.12.tgz")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar zxvf flink-1.13.3-bin-scala_2.12.tgz ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd flink-1.13.3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://repo1.maven.org/maven2/com/ververica/flink-connector-mysql-cdc/2.0.2/flink-connector-mysql-cdc-2.0.2.jar -P ./lib/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://github.com/hf200012/hf200012.github.io/raw/main/lib/doris-flink-1.0-SNAPSHOT.jar -P ./lib/")]),s._v("\n")])])]),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211026095513892.png"),alt:""}}),s._v(" "),a("h4",{attrs:{id:"_4-2-2-启动flink"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-启动flink"}},[s._v("#")]),s._v(" 4.2.2 启动Flink")]),s._v(" "),a("p",[s._v("这里我们使用的是本地单机模式")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# bin/start-cluster.sh\nStarting cluster.\nStarting standalonesession daemon on host doris01.\nStarting taskexecutor daemon on host doris01.\n")])])]),a("p",[s._v("我们通过web访问（默认端口是8081）启动起来Flink 集群，可以看到集群正常启动")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211025162831632.png"),alt:""}}),s._v(" "),a("h3",{attrs:{id:"_4-3-安装apache-doris"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-安装apache-doris"}},[s._v("#")]),s._v(" 4.3 安装Apache Doris")]),s._v(" "),a("p",[s._v("具体安装部署Doris的方法，参照下面的连接：")]),s._v(" "),a("p",[s._v("https://hf200012.github.io/2021/09/Apache-Doris-环境安装部署")]),s._v(" "),a("h3",{attrs:{id:"_4-3-安装配置-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-安装配置-mysql"}},[s._v("#")]),s._v(" 4.3 安装配置 Mysql")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("安装Mysql")]),s._v(" "),a("p",[s._v("快速使用Docker安装配置Mysql，具体参照下面的连接")]),s._v(" "),a("p",[s._v("https://segmentfault.com/a/1190000021523570")])]),s._v(" "),a("li",[a("p",[s._v("开启Mysql binlog")])])]),s._v(" "),a("p",[s._v("进入 Docker 容器修改/etc/my.cnf 文件，在 [mysqld] 下面添加以下内容，")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("log_bin=mysql_bin\nbinlog-format=Row\nserver-id=1\n")])])]),a("p",[s._v("然后重启Mysql")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl restart mysqld\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("创建Mysql数据库表")])]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("test_cdc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" \n")])])]),a("h3",{attrs:{id:"_4-4-创建doris表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-创建doris表"}},[s._v("#")]),s._v(" 4.4 创建doris表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("doris_test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("OLAP\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UNIQUE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMENT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OLAP"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTRIBUTED")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HASH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" BUCKETS "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n PROPERTIES "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"replication_num"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"in_memory"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"storage_format"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"V2"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"_4-5-启动-flink-sql-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-启动-flink-sql-client"}},[s._v("#")]),s._v(" 4.5 启动 Flink Sql Client")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./bin/sql-client.sh embedded\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" execution.result-mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tableau"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211025165547903.png"),alt:""}}),s._v(" "),a("h4",{attrs:{id:"_4-5-1-创建-flink-cdc-mysql-映射表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-1-创建-flink-cdc-mysql-映射表"}},[s._v("#")]),s._v(" 4.5.1 创建 Flink CDC Mysql 映射表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" test_flink_cdc "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" \n  id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  name STRING"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("primary")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" ENFORCED\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'connector'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-cdc'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hostname'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'port'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3306'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'database-name'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'demo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table-name'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test_cdc'")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("执行查询创建的Mysql映射表，显示正常")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("select * from test_flink_cdc;\n")])])]),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211026100505972.png"),alt:""}}),s._v(" "),a("h4",{attrs:{id:"_4-5-2-创建flink-doris-table-映射表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-2-创建flink-doris-table-映射表"}},[s._v("#")]),s._v(" 4.5.2 创建Flink Doris Table 映射表")]),s._v(" "),a("p",[s._v("使用Doris Flink Connector创建 Doris映射表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" doris_test_sink "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n   id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   name STRING\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WITH")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'connector'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'doris'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'fenodes'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:8030'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'table.identifier'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'db_audit.doris_test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sink.batch.size'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sink.batch.interval'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'username'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("在命令行下执行上面的语句，可以看到创建表成功，然后执行查询语句，验证是否正常")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" doris_test_sink"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211026100804091.png"),alt:""}}),s._v(" "),a("p",[s._v("执行插入操作，将Mysql 里的数据通过 Flink CDC结合Doris Flink Connector方式插入到 Doris中")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" doris_test_sink "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("name "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" test_flink_cdc\n")])])]),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211026101004547.png"),alt:""}}),s._v(" "),a("p",[s._v("提交成功之后我们在Flink的Web界面可以看到相关的Job任务信息")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211026100943474.png"),alt:""}}),s._v(" "),a("h4",{attrs:{id:"_4-5-3-向mysql表中插入数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-3-向mysql表中插入数据"}},[s._v("#")]),s._v(" 4.5.3 向Mysql表中插入数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'this is a update'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1212")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'测试flink CDC'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1234")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'这是测试'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("51233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("61233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_6'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("71233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_7'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("81233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91233")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangfeng_9'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h4",{attrs:{id:"_4-5-4-观察doris表的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-4-观察doris表的数据"}},[s._v("#")]),s._v(" 4.5.4 观察Doris表的数据")]),s._v(" "),a("p",[s._v("首先停掉Insert into这个任务，因为我是在本地单机模式，只有一个task任务，所以要停掉，然后在命令行执行查询语句才能看到数据")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211026101203629.png"),alt:""}}),s._v(" "),a("h4",{attrs:{id:"_4-5-5-修改mysql的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-5-修改mysql的数据"}},[s._v("#")]),s._v(" 4.5.5 修改Mysql的数据")]),s._v(" "),a("p",[s._v("重新启动Insert into任务")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211025182341086.png"),alt:""}}),s._v(" "),a("p",[s._v("修改Mysql表里的数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("update")]),s._v(" test_cdc "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'这个是验证修改的操作'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("where")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n")])])]),a("p",[s._v("再去观察Doris表中的数据，你会发现已经修改")]),s._v(" "),a("p",[s._v("注意这里如果要想Mysql表里的数据修改，Doris里的数据也同样修改，Doris数据表的模型要是Unique key模型，其他数据模型（Aggregate Key 和 Duplicate Key）不能进行数据的更新操作。")]),s._v(" "),a("img",{attrs:{src:s.$withBase("/images/blogs/flink-cdc-to-doris/image-20211025182435827.png"),alt:""}}),s._v(" "),a("h4",{attrs:{id:"_4-5-6-删除数据操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-6-删除数据操作"}},[s._v("#")]),s._v(" 4.5.6 删除数据操作")]),s._v(" "),a("p",[s._v("目前Doris Flink Connector 还不支持删除操作，后面计划会加上这个操作")])])}),[],!1,null,null,null);t.default=r.exports}}]);